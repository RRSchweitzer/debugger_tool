!function(){try{!function(u,m){window.getVPAIDAd=function(){try{if(S.ad)return S.ad;var e=function(){S.Util=n(),S.Queue=s(),S.VpaidAd=o(),S.MoatTag=a(),r();var e=S.Util.parseQS();if(e&&!S.Util.isEmptyObject(e)){S.qs=e;var t={};for(var i in e)t[i]=e[i];return t.wrapperType="js",new S.MoatTag(S.qs.pcode,t),new S.VpaidAd}S.Util.fireError("Unable to parse qs params")}();return S.ad=e}catch(e){S.Util.fireError("Error during MoatWrapper init",!0)}};function E(){function e(){this.availableResources=["StaticResource","IFrameResource","HTMLResource"],this.availableTypesMap={"image/gif":"img","image/jpeg":"img","image/png":"img","application/x-javascript":"js","application/x-shockwave-flash":"swf"},this.availableTypes=["swf","img"]}return e.prototype.loadCompanion=function(r,a,o,s,d,e,l,u){var h=this;function p(e,t,i,n,r,a,o,s){s=s||[];for(var d="",l=0;l<s.length;l++)d+='<img src="'+s[l]+'" style="display:none" width="1" height="1">';if("StaticResource"===r){if("img"==a){var u='<img src="'+t+'" width="'+i+'" height="'+n+'">';d+=o?'<a href="'+o+'" target="_blank">'+u+"</a>":u}if("swf"==a){var p=m.floor(1e7*m.random());d+='<object type="application/x-shockwave-flash" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/sho ckwave/cabs/flash/swflash.cab#version=8,0,0,0" width="'+i+'" height="'+n+'" id="companion'+(p-1)+'"><param name="allowScriptAccess" value="always" /><param name= "movie" value="'+t+'" />'+(o?'<param name="FlashVars" value="clickTag='+encodeURIComponent(o)+'" />':"")+'<param name="wmode" value="opaque" /><embed type="application/x-shockwave-flash" src="'+t+'" '+(o?'flashvars="clickTag='+encodeURIComponent(o)+'" ':"")+'wmode="opaque" width="'+i+'" height="'+n+'" id="companion'+p+'"name="companion'+p+'"allowscriptaccess="always" /></object>'}}return"IFrameResource"===r&&(d+="<iframe style='border:0px; padding:0px; margin:0px;' width='"+i+"' height='"+n+"' frameborder='no' scrolling='no' marginheight='0' marginwidth='0' src='"+t+"'></iframe>"),"HTMLResource"===r&&(d+=t,e&&(i&&(e.style.width=i+"px"),n&&(e.style.height=n+"px"))),S.HCP.companionAdRendered=!0,d}a=h.availableTypesMap[a];var c=!1;function t(){if(c)return!0;try{var e=a,t=function(e,t,n,r){var i,l="moatCompanionDiv_"+e+"x"+t;function a(e){var t=[],i=e.getElementById(l);i&&t.push(i);for(var n=0,r=h.availableResources.length;n<r;n++){var a;if("StaticResource"==h.availableResources[n])for(var o=0,s=h.availableTypes.length;o<s;o++){var d=e.getElementById(l+"_"+h.availableResources[n]+"_"+h.availableTypes[o]);d&&t.push(d)}else a=e.getElementById(l+"_"+h.availableResources[n]);a&&t.push(a)}return 0<t.length&&t}function o(e){if(!e||0==e.length)return!1;if(1==e.length)return e[0];for(var t=0,i=e.length;t<i;t++)if(r){if(e[t].id===l+"_"+n+"_"+r)return e[t]}else if(e[t].id===l+"_"+n)return e[t];return!1}try{i=o(a(document))||o(a(window.top.document))}catch(e){}if(i)return i;var s=[];try{for(var d=window.frames,u=0,p=d.length;u<p;u++){try{var c=a(d[u].document)}catch(e){}c&&(s=s.concat(c))}}catch(e){}return(i=o(s))||!1}(o,s,r,e);if(!t)return!1;if("DIV"!==t.nodeName){var i=t;i.id="";var n=S.Util.getParentNode(i);if(!n)return!1;t=document.createElement("div"),S.Util.addTagSafely(t,n)}else t.id="";t.innerHTML=p(t,d,o,s,r,e,l,u)}catch(e){return!1}return!0}var i,n,f,v=t();return v||(setTimeout(function(){!function e(t,i,n,r){r<=n||t()||(n++,setTimeout(function(){e(t,i,n,r)},i))}(t,500,0,10)},500),i=window,n="message",f=function(e){var t,i,n;c||"string"==typeof e.data&&(t=e.data.match(/^zMoatPlaceholder#([0-9]+)x([0-9]+)$/))&&(i=t[1],n=t[2],i==o&&n==s&&(c=function(e){try{var t=p(null,d,o,s,r,a,l,u);e.postMessage("zMoatAdContent#"+t,"*")}catch(e){return!1}return!0}(e.source)))},i.addEventListener?i.addEventListener(n,f,!1):i.attachEvent("on"+n,f)),v},e}function t(){function e(e){this.skipContainer,this.textContainer,this.iconContainer,this.skipIconUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAAKBJREFUOBFjYBgFsBD4////TCBmg/Hx0UB1FUD8CYi7cKoDSoLAMSCWxKkIKgFU8xSkGAh+4VQLkQeTz4CkJU6FQAmg/CuYepzqYAqg9E8gnYZLMVCOZANh5mMNV0oMBBmMEa6UGggyFCVckQ1kwhUuVBcHOQMHoKqXqRYpVE02KBGALWyBQUN0OsQILxwGEpX1sIYXDgNhhUM3NvlhLgYAYuCVi7Jf+AUAAAAASUVORK5CYII=",this.init(e)}return e.prototype.init=function(e){this.createContainer(),this.createTextContainer(),this.createIconContainer(),e.appendChild(this.skipContainer),this.updateButtonTextSubscription=S.Queue.subscribe("skip-button",this.updateButtonText.bind(this)),S.Queue.subscribe("vpaid-events",this.addClickHandler.bind(this)),S.HCP.skipButtonRendered=!0},e.prototype.createContainer=function(){this.skipContainer=document.createElement("div"),this.skipContainer.style.background="rgba(0,0,0,0.8)",this.skipContainer.style.color="#ffffff",this.skipContainer.style.fontSize="11px",this.skipContainer.style.fontFamily="arial,sans-serif",this.skipContainer.style.position="absolute",this.skipContainer.style.textAlign="center",this.skipContainer.style.right="0px",this.skipContainer.style.bottom="10%",this.skipContainer.style.padding="2%",this.skipContainer.style.cursor="default",S.Util.addListener(this.skipContainer,"click",this.stopEventPropagation,"stopEvtPropagationFn")},e.prototype.createTextContainer=function(){this.textContainer=document.createElement("span"),this.textContainer.style.verticalAlign="middle",this.skipContainer.appendChild(this.textContainer)},e.prototype.createIconContainer=function(){this.iconContainer=document.createElement("img"),this.iconContainer.style.display="none",this.iconContainer.style.verticalAlign="middle",this.iconContainer.setAttribute("src",this.skipIconUrl),this.skipContainer.appendChild(this.iconContainer)},e.prototype.updateButtonText=function(e){this.textContainer&&this.iconContainer&&this.skipContainer&&(0<e.timeLeft?this.textContainer.innerHTML="you can skip this ad in "+e.timeLeft:(this.textContainer.innerHTML="Skip Ad",this.textContainer.style.fontSize="18px",this.iconContainer.style.display="inline",this.updateButtonTextSubscription.remove(),this.skipContainer.style.cursor="pointer"))},e.prototype.skipAd=function(){S.underlyingAsset&&S.underlyingAsset.skipAd()},e.prototype.addClickHandler=function(e){e.type===S.VPAIDevents.AdSkippableStateChange&&(S.Util.addListener(this.skipContainer,"click",this.skipAd,"skipClickHandlerFn"),S.Util.removeListener(this.skipContainer,"click",this.stopEventPropagation,"stopEvtPropagationFn"))},e.prototype.stopEventPropagation=function(e){"function"==typeof e.stopPropagation&&e.stopPropagation()},e.prototype.cleanUp=function(){this.updateButtonTextSubscription.remove(),this.skipContainer.parentNode.removeChild(this.skipContainer),this.skipContainer=null,this.textContainer=null,this.iconContainer=null},e}var S={ad:null,version:"2.0",startTime:(new u).getTime(),rand:m.floor(m.random()*m.pow(10,8)),playerProvidedEventCallbacks:{},HCP:{},DispatchedQuartiles:{AdVideoStart:!1,AdVideoFirstQuartile:!1,AdVideoMidpoint:!1,AdVideoThirdQuartile:!1,AdVideoComplete:!1},VPAIDevents:{AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdRemainingTimeChange:"AdRemainingTimeChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",AdProgress:"AdProgress"},VPAIDmethods:{resizeAd:"resizeAd",startAd:"startAd",stopAd:"stopAd",pauseAd:"pauseAd",resumeAd:"resumeAd",expandAd:"expandAd",collapseAd:"collapseAd",skipAd:"skipAd"},AssetTypeMapping:{unknown:"-",asset:"1",vast:"2",vpaid:"3"}},n=function(){var o={safeCallbacks:{},findMoatScript:function(){for(var e=/moatwrapper/,t=document.getElementsByTagName("script"),i=t.length-1;0<=i;i--){var n=t[i];if(e.test(n.src))return n}},parseQS:function(){var e={},t=o.findMoatScript();if(!t)return!1;for(var i=t.src.split("#")[1].split("&"),n=i.length-1;0<=n;n--){var r=i[n].split("=");e[r[0]]=decodeURIComponent(r.slice(1).join("="))}return e.vast&&(e.vast=o.expandCachebuster(e.vast)),e},getScrUrls:function(){var e,t=S&&S.qs,i=[],n=new RegExp(/^scr\d{1,}/);if(!t)return i;for(var r in t)0===r.search(n)&&"string"==typeof(e=t[r])&&i.push(e);return i},getParentNode:function(e){return e.parentNode||e.parentElement||!1},getElementNodeTree:function(e){if(!e)return!1;for(var t="number"==typeof cap?cap:50,i=[e],n=!1,r=0;r<t&&((n=o.getParentNode(e))&&1===n);r++)e=n,i.push(e)},getSafeNode:function(e){if(!e)return!1;if("OBJECT"!==e.nodeName&&"EMBED"!==e.nodeName)return e;for(var t=o.getElementNodeTree(e),i=!1,n=0;n<t.length;n++){var r=t[n];if(r&&"OBJECT"!==r.nodeName&&"EMBED"!==r.nodeName){i=r;break}}return i},hasChildNodes:function(e){return e&&e.childNodes&&0<e.childNodes.length},addTagSafely:function(e,t){if(!e||!t)return!1;var i=o.getSafeNode(t);if(!i)return!1;if(o.hasChildNodes(i)){var n=i.childNodes[m.max(0,i.childNodes.length-1)]||null;i.insertBefore(e,n)}else i.appendChild(e);return i},addScriptToDOM:function(e,t,i){if("string"!=typeof e||!t||!document)return!1;var n=i||document.createElement("script");n.type="text/javascript";var r=o.addTagSafely(n,t);return!!r&&(n.src=e,r)},isANumber:function(e){return"number"==typeof e&&!isNaN(e)},expandCachebuster:function(e){return e.replace("[MOAT_CB]",""+(new u).getTime())},createXMLcompanionNode:function(e){if(!e||0===e.length)return"";for(var t,i,n,r,a,o,s,d,l=document.implementation.createDocument(null,"CompanionAds",null),u=e.length-1;0<=u;u--){if(t=e[u],(i=l.createElementNS("","Companion")).setAttributeNS("","width",t.width),i.setAttributeNS("","height",t.height),(n=l.createElementNS("","StaticResource")).setAttributeNS("","type",t.type),n.appendChild(l.createCDATASection(t.staticResource)),i.appendChild(n),t.companionClickThroughURLTemplate&&((r=l.createElementNS("","CompanionClickThrough")).appendChild(l.createCDATASection(t.companionClickThroughURLTemplate)),i.appendChild(r)),t.trackingEvents&&t.trackingEvents.creativeView){a=l.createElementNS("","TrackingEvents");for(var p=(o=t.trackingEvents.creativeView).length-1;0<=p;p--)s=o[p],(d=l.createElementNS("","Tracking")).setAttributeNS("","event","creativeView"),d.appendChild(l.createCDATASection(s)),a.appendChild(d);i.appendChild(a)}l.documentElement.appendChild(i)}return(new XMLSerializer).serializeToString(l)},emptyObj:{},isArray:function(e){try{return"[object Array]"===o.emptyObj.toString.call(e)}catch(e){return!1}},indexOf:function(e,t){if(!e)return-1;if(o.isArray(e)){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}return"string"==typeof e&&(t||"string"!=typeof t)?e.indexOf(t):-1},arrayContains:function(e,t){return-1!==o.indexOf(e,t)},isFunction:function(e){try{return"[object Function]"===o.emptyObj.toString.call(e)}catch(e){return!1}},isEmptyObject:function(e){try{for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}catch(e){return!1}},isNumber:function(e){try{return"[object Number]"===o.emptyObj.toString.call(e)}catch(e){return!1}},getQueryString:function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=i+"="+encodeURIComponent(n);t.push(r)}return t.join("&")}};return o.getHash=function(e,t){var i=new u;return function(e){var t=0;if(e.length<1)return t;for(var i=0;i<e.length;i++){t=(t<<5)-t+e.charCodeAt(i),t&=t}return m.abs(t)}(e+=t+[i.getFullYear(),("0"+(i.getMonth()+1)).slice(-2),("0"+i.getDate()).slice(-2)].join("-"))},o.timeouts=[],o.loops={},o.fireError=function(e,t){var i,n,r,a;try{i=S.qs.level1+"%3A"+S.qs.level2+"%3A"+S.qs.level3+"%3A"+S.qs.level4}catch(e){i="data%3Adata%3Adata%3Adata"}try{n=(n=S.qs.vast||S.qs.asset).replace(/gdpr_consent=[^&]*&?/i,"")}catch(e){n="-"}try{r=S.moatTag?S.moatTag.pcode:S.PARTNER_CODE}catch(e){r="-"}try{a=S.AssetTypeMapping[S.underlyingTagType]}catch(e){a=S.AssetTypeMapping.unknown}var o="//px.moatads.com/pixel.gif?e=24&d="+i+"&i="+encodeURIComponent("TRADEDESKVIDEO1")+"&rp=1&gw="+r+"&k="+encodeURIComponent(e)+"&ar="+encodeURIComponent("c26ce66e-clean")+"&iw="+encodeURIComponent("0625568")+"&j="+encodeURIComponent(document.referrer)+"&zMoatVast="+encodeURIComponent(n)+"&dMoatUTT="+a+"&dMoatIT="+!!t+"&cs="+(new u).getTime(),s=new Image;t&&(s.onload=function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdError,args:[e]})}),s.src=o},o.makeSafe=function(e,i,n){var r=!1;return function(){try{return i?n?e.apply(n,arguments):e.apply(this,arguments):e.apply(null,arguments)}catch(e){if(!r){S.HCP.hadMSE=!0;var t=e.name+" in makeSafe: "+e.message+", stack="+e.stack;r=!0,S.Util.fireError(t,!0)}}}},o.setSafeTimeout=function(e,t){var i;return e=o.makeSafe(e),window&&window.setTimeout&&(i=window.setTimeout(e,t),o.timeouts.push(i)),i},o.setSafeLoop=function(e,t,i){if(o.isFunction(e)&&o.isArray(t)&&o.isNumber(i)){var n=(new u).getTime()+"";o.loops[n]&&window.clearTimeout(o.loops[n].tid),o.loops[n]={},o.loops[n].callback=o.makeSafe(e,t),o.loops[n].interval=i,o.loops[n].tid=o.setSafeTimeout(o.runLoop(n),i),n=i=t=e=null}},o.runLoop=function(t){return function(){if(!o.loops||!o.loops[t])return!1;var e=o.loops[t].callback.call(null);if("boolean"==typeof e&&!1===e)return window.clearTimeout(o.loops[t].tid),o.loops[t]=!1;o.loops[t].tid=o.setSafeTimeout(o.runLoop(t),o.loops[t].interval),t=e=null}},o.objectToQueryString=function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=i+"="+encodeURIComponent(n);t.push(r)}return t.join("&")},o.addListener=function(e,t,i,n){var r,a=this.makeSafe(i);if(r=e.addEventListener?{name:"addEventListener",evtPrefix:""}:{name:"attachEvent",evtPrefix:"on"},e&&r.name&&e[r.name])try{e[r.name](r.evtPrefix+t,a,!1)}catch(e){}!1!==n&&(o.safeCallbacks[t+n]=a)},o.removeListener=function(e,t,i,n){var r,a=t+n;if(!e)return delete o.safeCallbacks[a],!1;try{e.removeEventListener;e.detachEvent}catch(e){return delete o.safeCallbacks[a],!1}i=!1!==n?o.safeCallbacks[a]:i,r=e.removeEventListener?{name:"removeEventListener",evtPrefix:""}:{name:"detachEvent",evtPrefix:"on"};try{e[r.name](r.evtPrefix+t,i,!1)}catch(e){}delete o.safeCallbacks[a]},o.getVastUrl=function(){var t;try{t=(t=S.qs.vast||S.qs.asset).replace(/gdpr_consent=[^&]*&?/i,"")}catch(e){t="-"}return t},o.sendHealthCheckPixel=function(e,t){var i;if((i=t)&&S.Util.arrayContains(["WrapperFound","AdStarted","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdStopped","AdSkipped"],i))if(S.DispatchedQuartiles.hasOwnProperty(t))!1===S.DispatchedQuartiles[t]&&(S.DispatchedQuartiles[t]=!0);else{var n="VPAID_HC",r={},a=encodeURIComponent(e.pcode)||"-",o=S.Util.getVastUrl(),s={WrapperFound:17,AdStarted:0,AdVideoStart:29,AdVideoFirstQuartile:29,AdVideoMidpoint:29,AdVideoThirdQuartile:29,AdVideoComplete:29,AdStopped:28,AdSkipped:33}[t];r.e=s,r.i=n,r.dMoatWVH=encodeURIComponent("TRADEDESKVIDEO1")+"_WRAPPER",r.gw=a,r.d="data:data:data:data",r.de=S.rand,r.t=S.startTime,r.bq=8,r.ar="c26ce66e-clean",r.iw="0625568",r.j=encodeURIComponent(document.referrer),r.ah=(new u).getTime()-S.startTime,S.HCP.moatVideoLoaded&&(r.wvl=1),S.DispatchedQuartiles.AdVideoStart&&(r.wrf=1),S.DispatchedQuartiles.AdVideoFirstQuartile&&(r.wrg=1),S.DispatchedQuartiles.AdVideoMidpoint&&(r.wrh=1),S.DispatchedQuartiles.AdVideoThirdQuartile&&(r.wri=1),S.DispatchedQuartiles.AdVideoComplete&&(r.wrj=1),r.dMoatVAST=o,S.underlyingTagType?r.dMoatUTT=S.AssetTypeMapping[S.underlyingTagType]:r.dMoatUTT=S.AssetTypeMapping.unknown,S.HCP.adIconAvailable&&(r.dMoatIconAvailable=1),S.HCP.adIconRendered&&(r.dMoatIconRendered=1),S.HCP.skipButtonAvailable&&(r.dMoatSkipButtonAvailable=1),S.HCP.skipButtonRendered&&(r.dMoatSkipButtonRendered=1),S.HCP.companionAdAvailable&&(r.dMoatCompanionAdAvailable=1),S.HCP.companionAdRendered&&(r.dMoatCompanionAdRendered=1),S.HCP.hadMSE&&(r.dMoatHadMSE=1);var d=this.getQueryString(r),l="//px.moatads.com/pixel.gif?"+(d=d.replace(/\x27/g,"%27"))+"&na="+this.getHash(d,n)+"&cs=0";if(0)(new Image).src=l}},o.getDocAndWinOfEl=function(e){var t,i;try{i=(t=e.ownerDocument)&&(t.defaultView||t.parentWindow)}catch(e){}return{elDoc:t,elWin:i}},o.isPromise=function(e){return!!e&&"function"==typeof e.then&&"function"==typeof e.catch},o.isANumber=function(e){return"number"==typeof e&&!isNaN(e)},o},r=function(){S.Queue.subscribe("vpaid-events",function(e){var t=e.type,i=e.args;if(S.playerProvidedEventCallbacks[t])for(var n=S.playerProvidedEventCallbacks[t],r=n.length-1;0<=r;r--){var a=n[r],o=a.fn,s=a.listenerScope;s=s||null;try{o.apply(s,i)}catch(e){}}})},a=function(){function e(e,t){(S.moatTag=this).pcode=e,this.ids=t,this.moatapi,this.eventBuffer=[],this.init()}return e.prototype.init=function(){var a=this;S.Util.sendHealthCheckPixel(a.ids,"WrapperFound"),S.Queue.subscribe("moat-tag",function(e){a.initMoatTracking(e.videoElement,e.duration)}),S.Queue.subscribe("vpaid-events",function(e){var t;t=e.type!==S.VPAIDevents.AdError?S.ad.getAdVolume():-1;var i={type:e.type,adVolume:t};if(e.type===S.VPAIDevents.AdDurationChange&&(i.duration=e.args[0],i.confirmed=!0),"moat_DURATION_DEBUG"===e.type){if(!e.args||e.length<2)return;i[e.args[0]]=e.args[1]}if(a.moatapi&&"function"==typeof a.moatapi.dispatchEvent){if(a.eventBuffer&&0<a.eventBuffer.length)for(var n=a.eventBuffer.length-1;0<=n;n--){var r=a.eventBuffer[n];a.moatapi.dispatchEvent(r)}a.eventBuffer=!1,a.moatapi.dispatchEvent(i)}else a.eventBuffer&&a.eventBuffer.push(i);S.Util.sendHealthCheckPixel(a.ids,i.type)}),S.Queue.subscribe("moatapi-events",function(e){a.moatapi&&a.moatapi.adData&&a.moatapi.adData.ids&&!a.moatapi.adData.ids[e.property]?a.moatapi.adData.ids[e.property]=e.value:a.ids&&!a.ids[e.property]&&(a.ids[e.property]=e.value)}),S.Queue.subscribe("moatvideo-events",function(e){e.type&&"AdClicked"===e.type&&S.underlyingAsset&&S.underlyingAsset.onAdClickHandler&&S.underlyingAsset.onAdClickHandler()})},e.prototype.initMoatTracking=function(e,t){var i=document.createElement("script"),n=[],r={vidIntType:"2",vidIntVersion:"6.1",adData:{ids:this.ids,duration:t},dispatchEvent:function(e){this.sendEvent?(n&&(n.push(e),e=n,n=!1),this.sendEvent(e)):n&&n.push(e)},publishToWrapper:function(e){S.Queue.publish("moatvideo-events",e)}},a="_moatApi"+m.floor(1e8*m.random()),o=S.Util.getDocAndWinOfEl(e),s=(o.elDoc,o.elWin);if(!s)return!1;this.moatapi=s[a]=r,i.type="text/javascript",e&&e.insertBefore(i,e.childNodes[0]||null);var d="#"+a;i.src="https://z.moatads.com/"+this.pcode+"/moatvideo.js"+d},e},o=function(){function e(){this._width,this._height,this._viewMode,this._desiredBitrate,this._creativeData,this._environmentVars,this._slot,this._videoSlot,this._domElToTrack,this._hasIcons=!1,this._adStopped}return e.prototype={initAd:S.Util.makeSafe(function(e,t,i,n,r,a){if(this._width=e,this._height=t,this._viewMode=i||"normal",this._desiredBitrate=n,this._creativeData=r,this._environmentVars=a,this._slot=a.slot,this._videoSlot=a.videoSlot,"string"==typeof this._videoSlot.nodeName&&"number"==typeof this._videoSlot.nodeType?this._domElToTrack=this._videoSlot:this._domElToTrack=this._slot,S&&S.moatTag&&S.moatTag.ids&&this._domElToTrack){t="number"==typeof this._domElToTrack.offsetHeight?this._domElToTrack.offsetHeight:"-",e="number"==typeof this._domElToTrack.offsetWidth?this._domElToTrack.offsetHeight:"-";S.moatTag.ids.origSize=e+"x"+t}if(this._domElToTrack&&this._domElToTrack.parentNode&&this._domElToTrack.parentNode.id&&"fw-pdk-plugin-video-display-base"==this._domElToTrack.parentNode.id){var o=this._domElToTrack.offsetHeight,s=this._domElToTrack.offsetWidth;("number"==typeof o&&!isNaN(o)&&0==o||"number"==typeof s&&!isNaN(s)&&0==s)&&this._height&&this._width&&this._domElToTrack.style&&(this._domElToTrack.style.height=this._height+"px",this._domElToTrack.style.width=this._width+"px")}S.qs.vast,S.qs.asset;if(S.qs.vast)S.VastLoader=p(),(new S.VastLoader).request(S.qs.vast),S.underlyingTagType="vast";else if(S.qs.asset){S.VideoPlayer=V();var d=new S.VideoPlayer;S.underlyingAsset=d;var l=[{fileURL:S.qs.asset,mimeType:"video/mp4",height:this._height,width:this._width,bitrate:this._desiredBitrate}];S.underlyingTagType="asset",d.init(l,!1,S.qs.clickTag,!1)}else S.Util.fireError("Problem retrieving video file from underlying tag/asset",!0)},!0),collapseAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.collapseAd()},!0),constructor:S.Util.makeSafe(constructor,!0),expandAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.expandAd()},!0),getAdCompanions:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdCompanions()},!0),getAdDuration:S.Util.makeSafe(function(){return S.underlyingAsset?S.underlyingAsset.getAdDuration():-2},!0),getAdExpanded:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdExpanded()},!0),getAdHeight:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdHeight()},!0),getAdIcons:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdIcons()||S.ad._hasIcons},!0),getAdLinear:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdLinear()},!0),getAdRemainingTime:S.Util.makeSafe(function(){return S.underlyingAsset?S.underlyingAsset.getAdRemainingTime():-2},!0),getAdSkippableState:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdSkippableState()},!0),getAdVolume:S.Util.makeSafe(function(){return S.underlyingAsset?S.underlyingAsset.getAdVolume():1},!0),getAdWidth:S.Util.makeSafe(function(){if(S.underlyingAsset)return S.underlyingAsset.getAdWidth()},!0),handshakeVersion:S.Util.makeSafe(function(e){return S.version},!0),pauseAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.pauseAd()},!0),resizeAd:S.Util.makeSafe(function(e,t,i){S.underlyingAsset&&S.underlyingAsset.resizeAd(e,t,i)},!0),resumeAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.resumeAd()},!0),setAdVolume:S.Util.makeSafe(function(e){!1===isNaN(e)&0<=e&&e<=1&&S.underlyingAsset&&S.underlyingAsset.setAdVolume(e)},!0),skipAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.skipAd()},!0),startAd:S.Util.makeSafe(function(){S.underlyingAsset&&S.underlyingAsset.startAd()},!0),stopAd:S.Util.makeSafe(function(){!0!==this._adStopped&&S.underlyingAsset&&(S.underlyingAsset.stopAd(),this._adStopped=!0)},!0),subscribe:S.Util.makeSafe(function(e,t,i){var n=S.playerProvidedEventCallbacks;n[t]?n[t].push({fn:e,listenerScope:i}):n[t]=[{fn:e,listenerScope:i}]},!0),unsubscribe:S.Util.makeSafe(function(e,t){var i=S.playerProvidedEventCallbacks[t];if(i&&i.length)for(var n=i.length-1;0<=n;n--){e===i[n].fn&&i.splice(n,1)}},!0)},e},s=function(){var a={"vpaid-events":[],"moat-tag":[],"internal-events":[],"skip-button":[],"moatapi-events":[],"brandsafety::ready":[],"moatvideo-events":[],"wrapper-to-moatvideo-events":[]};return{subscribe:function(e,t){if(a[e]){var i=a[e].push(t)-1;return{remove:function(){delete a[e][i]}}}},publish:function(e,t){if(a[e])for(var i=a[e],n=i.length-1;0<=n;n--){var r=i[n];"function"==typeof r&&r.call(null,t)}}}},d=(e.prototype.init=function(){if(this.icons&&this.icons.length){for(var e=0;e<this.icons.length;e++)this.createIcon(this.icons[e]);this.iconsCreated=!0,S.ad._hasIcons=!0}},e.prototype.createIconContainer=function(e){var t=document.createElement("DIV");return t.id="icon"+e.program,t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.position="absolute",t.style.left="number"==typeof e.xPosition?e.xPosition+"px":this.calculateLeft(e.xPosition,e.width),t.style.top="number"==typeof e.yPosition?e.yPosition+"px":this.calculateTop(e.yPosition,e.height),t.style.zIndex="2147483647",t},e.prototype.createIconAnchor=function(e){var t=document.createElement("A");return t.href=e,t.target="_blank",t},e.prototype.createIconLogo=function(e){var t=document.createElement("IMG");return t.src=e,t.border="0px",t.style.width="100%",t.style.height="100%",t},e.prototype.createIcon=function(e){if(S.Util.isANumber(e.width)&&S.Util.isANumber(e.height)&&e.staticResource){var t=this.createIconContainer(e),i=this.createIconLogo(e.staticResource);if(e.iconClickThroughURLTemplate){var n=this.createIconAnchor(e.iconClickThroughURLTemplate);n.appendChild(i),t.appendChild(n)}else t.appendChild(i);"VIDEO"===this.playerEl.nodeName?this.playerEl.parentNode&&"function"==typeof this.playerEl.parentNode.insertBefore&&this.playerEl.parentNode.insertBefore(t,this.playerEl.nextSibling):this.playerEl.appendChild(t),S.Util.addListener(t,"click",l,"iconClickListener"+this.iconNodes.length),this.iconNodes.push(t),S.HCP.adIconRendered=!0}},e.prototype.calculateLeft=function(e,t){if("string"==typeof e&&"left"===e.toLowerCase())return"0px";var i=this.playerEl.offsetWidth||this.playerEl.clientWidth||0;return Number(i)-Number(t)+"px"},e.prototype.calculateTop=function(e,t){if("string"==typeof e&&"top"===e.toLowerCase())return"0px";var i=this.playerEl.offsetHeight||this.playerEl.clientHeight||0;return Number(i)-Number(t)+"px"},e.prototype.adjustIconPostionOnResize=function(){if(null!==this.iconNodes&&0!==this.iconNodes.length)for(var e=0;e<this.iconNodes.length;e++){var t=this.iconNodes[e];"0px"!==t.style.left&&(t.style.left=this.calculateLeft(null,t.style.width.slice(0,-2))),"0px"!==t.style.top&&(t.style.top=this.calculateTop(null,t.style.height.slice(0,-2)))}},e.prototype.vpaidEventSubscription=function(e){switch(e.type){case S.VPAIDevents.AdVideoStart:this.iconsCreated||this.init();break;case S.VPAIDevents.AdSizeChange:this.iconsCreated&&this.adjustIconPostionOnResize();break;case S.VPAIDevents.AdVideoComplete:case S.VPAIDevents.AdStopped:case S.VPAIDevents.AdSkipped:case S.VPAIDevents.AdError:this.cleanUpCalled||this.cleanUp();break;default:break}},e.prototype.cleanUp=function(){this.subscription.remove();for(var e=0;e<this.iconNodes.length;e++){var t=this.iconNodes[e];S.Util.removeListener(t,"click",l,"iconClickListener"+e);var i=t.parentNode;i&&i.removeChild&&i.removeChild(t)}this.playerEl=null,this.icons=null,this.iconNodes=null,this.cleanUpCalled=!0,S.ad._icons=!1},e);function e(e,t){this.iconNodes=[],this.icons=e,this.playerEl=t,this.iconsCreated=!1,this.cleanUpCalled=!1,this.subscription=S.Queue.subscribe("vpaid-events",this.vpaidEventSubscription.bind(this))}function l(e){return e.stopPropagation(),!1}var U=function(){var g={AdSkipped:"skip",AdStarted:"creativeView",AdVideoStart:"start",AdVideoFirstQuartile:"firstQuartile",AdVideoMidpoint:"midpoint",AdVideoThirdQuartile:"thirdQuartile",AdVideoComplete:"complete",AdUserAcceptInvitation:"acceptInvitation",AdUserMinimize:"collapse",AdUserClose:"close",AdPaused:"pause",AdPlaying:"resume",AdError:"error",AdProgress:"progress"};function A(e,t){return t&&e&&e[t]?e[t]:[]}return ProgressEventDetails=function(e,t,i){this.urls=e,this.format=t,this.value=i},(U=function(e,t,i,n,r,a){this.trackingEvents=e,this.impressionURLs=t,this.scrURLS=S.Util.getScrUrls(),this.errorURLs=i,this.clicktrackingURLs=n,this.customTrackingEvents=a,this.lastVolume=!1,this.surveys=r,this.init()}).prototype.init=function(){var m=this;m.progressEvents=function(e){var t={},i=/progress-([0-9]+)/;for(var n in e)if(-1<S.Util.indexOf(n,"progress")){var r=n.match(i);if(!r||r.length<2)continue;var a=e[n],o=r[1];-1<S.Util.indexOf(n,"%")?t[n]=new ProgressEventDetails(a,"percentage",parseFloat(o/100)):t[n]=new ProgressEventDetails(a,"number",parseFloat(o))}return t}(this.trackingEvents),S.Queue.subscribe("internal-events",function(e){m.lastVolume=e.volume}),S.Queue.subscribe("vpaid-events",function(e){var t,i,n=!1;switch(e.type){case S.VPAIDevents.AdImpression:m.handleSurveys(),t=m.impressionURLs,n=!0;break;case S.VPAIDevents.AdVolumeChange:var r,a=S.underlyingAsset&&S.underlyingAsset.getAdVolume();"number"==typeof m.lastVolume&&"number"==typeof a&&(0===a&&0<m.lastVolume?r="mute":0<a&&0===m.lastVolume&&(r="unmute")),m.lastVolume=a,r&&(t=m.trackingEvents[r]);break;case S.VPAIDevents.AdClickThru:t=m.clicktrackingURLs;break;case S.VPAIDevents.AdError:t=m.errorURLs;break;case S.VPAIDevents.AdProgress:var o=[];for(var s in m.progressEvents){var d=m.progressEvents[s],l=e.time;if("percentage"==d.format){var u=-2!=S.underlyingAsset.getAdDuration(),p=d.value*S.underlyingAsset.getAdDuration();u&&p<l&&(o=o.concat(d.urls),delete m.progressEvents[s])}else l>d.value&&(o=o.concat(d.urls),delete m.progressEvents[s])}t=o;break;default:var c=g[e.type];t=A(m.trackingEvents,c).concat(A(m.customTrackingEvents,c));break}if(t)for(var h=t.length-1;0<=h;h--)if("string"==typeof(i=t[h]))try{(new Image).src=i}catch(e){}if(n)for(var f=m.scrURLS,v=f.length-1;0<=v;v--)S.Util.addScriptToDOM(f[v],S.ad._domElToTrack)})},U.prototype.handleSurveys=function(){if(this.surveys&&S.ad._domElToTrack)for(var e,t,i,n=S.ad._domElToTrack,r=this.surveys,a=!1,o=0;o<r.length;o++)if("js"===u(i=r[o])){if(!a){var s=S.Util.getDocAndWinOfEl(n);e=s.elDoc,t=s.elWin,a=!0}if(!t)continue;var d=e.createElement("script");d.src=i.url,d.type="text/javascript";var l=S.Util.getParentNode(n)||n;l.insertBefore(d,l.childNodes[0]||null)}else(new Image).src=i.url;function u(e){var t="";if(e.type){var i=e.type.split("/");t="javascript"===i[i.length-1]?"js":"pixel"}else{var n=e.url.match(/([^/&?#]+)(?:$|#|\?)/i),r=n&&2===n.length&&n[1],a=r&&r.split(".");t=a&&a[a.length-1]}return"js"===t?"js":"pixel"}},U},p=function(){function e(){}function b(e,t){var i;for(var n in t)"id"===n.toLowerCase()?e.creativeId=t[n]:"adid"===n.toLowerCase()&&(i=t[n]);e.creativeId?i&&(e.creativeAdId=i):i&&(e.creativeId=i),e.creativeId&&S.Queue.publish("moatapi-events",{property:"zMoatCreativeId",value:e.creativeId}),e.creativeAdId&&S.Queue.publish("moatapi-events",{property:"zMoatCreativeAdId",value:e.creativeAdId})}return e.prototype.request=function(e){var t=this,i=!1;e&&e.match("ad.doubleclick.net")&&(i=!0),DMVAST.client.get(e,{withCredentials:i},S.Util.makeSafe(function(e){e?t.extractStuff(e):S.Util.fireError("no VAST tag response",!0)}))},e.prototype.extractStuff=function(e){var t=["progressive"];if(e&&e.ads&&0!==e.ads.length){var i={linearCreatives:[],companions:[]},n=e.ads[0];n.id&&"null"!==n.id&&S.Queue.publish("moatapi-events",{property:"zMoatAdId",value:n.id});var r=n&&n.creatives&&n.creatives[0]&&n.creatives[0].videoClickThroughURLTemplate;r&&S.Queue.publish("moatapi-events",{property:"zMoatClickThrough",value:r});for(var a=n.creatives,o=0;o<a.length;o++){var s=a[o];switch(s.type){case"linear":for(var d={duration:s.duration,adParameters:s.adParameters,trackingEvents:s.trackingEvents,clickthroughURL:s.videoClickThroughURLTemplate,clicktrackingURLs:s.videoClickTrackingURLTemplates,vpaid:[],videos:[],skipoffset:s.skipDelay,icons:s.icons},l=s.mediaFiles,u=0;u<l.length;u++){var p=l[u];if(p&&p.fileURL){var c=p.mimeType.toLowerCase(),h=p.deliveryType.toLowerCase();"VPAID"!==p.apiFramework||"application/javascript"!==c&&"application/x-javascript"!==c||!S.Util.arrayContains(t,h)||d.vpaid.push(p),S.Util.arrayContains(t,h)&&d.videos.push(p)}}i.linearCreatives.push(d),n.creativeId||b(n,s.attributes);break;case"companion":for(var f=0;f<s.variations.length;f++)i.companions.push(s.variations[f])}}var v,m=i.linearCreatives.length;if(1===m)v=i.linearCreatives[0];else for(o=0;o<m;o++){var g=i.linearCreatives[o];if(0<g.videos.length||0<g.vpaid.length){v=g;break}}if(v||S.Util.fireError("No suitable assets found",!0),v.customTrackingEvents=function(e){var t=e.extensions,a={};function o(e){if(void 0!==e.children&&0!==e.children.length)for(var t=e.children,i=0;i<t.length;i++){if("Tracking"===t[i].name){var n=t[i].attributes.event,r=t[i].value;a[n]=[r]}o(t[i])}}for(var i in t)o(t[i]);return a}(n),S.TrackerManager=U(),new S.TrackerManager(v.trackingEvents,n.impressionURLTemplates,n.errorURLTemplates,v.clicktrackingURLs,n.surveys,v.customTrackingEvents),0<i.companions.length){S.HCP.companionAdAvailable=!0,S.CompanionLoader=E();for(var A=new S.CompanionLoader,y=0;y<i.companions.length;y++){var _,k,C=i.companions[y];C.htmlResource?(_="HTMLResource",k=C.htmlResource):C.iframeResource?(_="IFrameResource",k=C.iframeResource):C.staticResource&&(_="StaticResource",k=C.staticResource),A.loadCompanion(_,C.type,C.width,C.height,k,!1,C.companionClickThroughURLTemplate,C.trackingEvents.creativeView)}}if(0<v.vpaid.length)return S.underlyingTagType="vpaid",S.VpaidPlayer=w(),void(T=new S.VpaidPlayer).init(v.vpaid[0],v.adParameters,v.duration,i.companions,v.icons,v.clickthroughURL);if(0<v.videos.length){S.Queue.publish("vpaid-events",{type:"moat_DURATION_DEBUG",args:["mediafile","video"]}),S.Queue.publish("vpaid-events",{type:"moat_DURATION_DEBUG",args:["vast-duration",v.duration]}),S.VideoPlayer=V();var T=new S.VideoPlayer;(S.underlyingAsset=T).init(v.videos,v.duration,v.clickthroughURL,i.companions,v.skipoffset,v.icons)}else S.Util.fireError("No suitable assets found",!0)}else S.Util.fireError("problem parsing underlying VAST, missing <ad> nodes")},e},V=function(){function e(){this._videoEl,this._adIsStarted,this._firstQuartileTime,this._firstQuartileReached,this._midpointTime,this._midpointReached,this._thirdQuartileTime,this._thirdQuartileReached,this._videoIsCompleted,this._lastViewMode,this._originalSlotCursorStyle,this._originalVideoSlotCursorStyle,this._pauseAdOnClickThru=!0,this._clickthroughURL,this._lastClickTime,this._skipoffset,this._cleanupCalled,this._durationConfirmed=!1,this._adLinear=!0,this._adWidth=S.ad._width,this._adHeight=S.ad._height,this._adExpanded=!1,this._adSkippableState=!1,this._adRemainingTime=-2,this._adDuration=-2,this._adVolume=1,this._adCompanions="",this._adIcons=!1,this._skipButtonModule=t(),this._skipButtonManager,this._icons,this._iconManager}function a(e){return"string"==typeof e.message&&""!==e.message?e.message:e.target&&e.target.error&&"string"==typeof e.target.error.message?""===e.target.error.message?"unknown error triggered by player":e.target.error.message:"unknown error triggered by player"}return e.prototype.init=function(e,t,i,n,r,a){this._videoEl=S.ad._videoSlot,this._adDuration=this._adRemainingTime=t,this._mediaFile=this.pickMediaFile(e);this._skipoffset=function(){var e=r;if(S.Util.isANumber(e))return e;var t=parseInt(S.qs.skip,10);if(S.Util.isANumber(t))return t;var i=parseInt(S.qs.zMoatSkip,10);return S.Util.isANumber(i)?i:null}();var o=S&&S.ad&&S.ad._slot,s=S&&S.ad&&S.ad._videoSlot;o&&o.style&&(this._originalSlotCursorStyle=o.style.cursor,o.style.cursor="pointer"),s&&s.style&&(this._originalVideoSlotCursorStyle=s.style.cursor,s.style.cursor="pointer"),void 0!==this._videoEl.volume&&"number"==typeof this._videoEl.volume&&(this._adVolume=this._videoEl.volume),S.Queue.publish("internal-events",{volume:this._adVolume}),this._clickthroughURL=i,this._lastViewMode=S.ad._viewMode,this._adCompanions=S.Util.createXMLcompanionNode(n),this._icons=a,this.onAdClickHandler=this.onAdClick.bind(this),this.onErrorHandler=this.videoErrorHandlerFn,this.createListeners(),"1"===S.qs.noctp&&(this._pauseAdOnClickThru=!1);var d=this._videoEl;this.setVideoElSrc(this._mediaFile),d.load(),S.Util.addListener(d,"canplay",this.publishAdLoaded,"publishAdLoadedFn"),this._adDuration&&(this.determineQuartiles(),S.Queue.publish("moat-tag",{videoElement:S.ad._domElToTrack,duration:this._adDuration}))},e.prototype.publishAdLoaded=function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdLoaded}),S.Util.removeListener(S.underlyingAsset._videoEl,"canplay",this.publishAdLoaded,"publishAdLoadedFn")},e.prototype.resizeAd=function(e,t,i,n){"string"==typeof i&&(i=i.toLowerCase());var r=i&&"fullscreen"===i,a="number"==typeof e&&"number"==typeof t&&!isNaN(e)&&!isNaN(t),o=!r&&a;!r&&!a||o&&!this._videoEl||(o&&(this._adHeight=t,this._adWidth=e,this._videoEl.width=e,this._videoEl.height=t),n&&S.ad._slot&&(S.ad._slot.style.width=e+"px",S.ad._slot.style.height=t+"px"),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdSizeChange}))},e.prototype.playVideoEl=function(e){var t=this._videoEl.play();return S.Util.isPromise(t)?t.then(e).catch(this.onErrorHandler):(e(),null)},e.prototype.playVideoElandFireStartEvents=function(){var e=this._videoEl,t=!1,i=!1;function n(){this._adIsStarted||(this._adIsStarted=!0,this._adTimeFrequency=0,this.timer(),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdStarted}),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdImpression}),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoStart}))}function r(){i&&t&&(S.Util.removeListener(e,"playing",a,"videoPlayingHandlerFn"),n())}function a(){t=!0,r()}n=n.bind(this),S.Util.addListener(e,"playing",a,"videoPlayingHandlerFn"),this.playVideoEl(function(){i=!0,r()})},e.prototype.startAd=function(){if(!this._adIsStarted){if(S.ad&&S.ad._slot){var e="function"==typeof window.getComputedStyle&&window.getComputedStyle(S.ad._slot)||S.ad._slot.style||S.ad._slot.currentStyle;e&&S.ad._width&&S.ad._height&&("0px"==e.width&&0<S.ad._width||"0px"==e.height&&0<S.ad._height)&&this.resizeAd(S.ad._width,S.ad._height,S.ad._viewMode||"normal",!0)}S.Util.isANumber(this._skipoffset)?(this._skipButtonManager=new this._skipButtonModule(S.ad._slot),S.HCP.skipButtonAvailable=!0):this._skipButtonManager=null,this.playVideoElandFireStartEvents(),this._icons&&this._icons.length&&(this._iconManager=new d(this._icons,S.ad._domElToTrack),this._adIcons=!0,S.HCP.adIconAvailable=!0)}},e.prototype.stopAd=function(){this.cleanUp(),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdStopped})},e.prototype.pauseAd=function(){this._videoEl.paused||(this._videoEl.pause(),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdPaused}))},e.prototype.resumeAd=function(){this.playVideoEl(function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdPlaying})})},e.prototype.skipAd=function(){this.cleanUp(),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdSkipped});S.Util.setSafeTimeout(function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdStopped})},400)},e.prototype.getAdLinear=function(){return this._adLinear},e.prototype.getAdCompanions=function(){return this._adCompanions},e.prototype.getAdExpanded=function(){return this._adExpanded},e.prototype.getAdHeight=function(){return this._adHeight},e.prototype.getAdWidth=function(){return this._adWidth},e.prototype.getAdVolume=function(){var e=1,t=this._videoEl.volume,i=this._adVolume;return this._videoEl.muted?e=0:"number"!=typeof t||isNaN(t)?"number"!=typeof i||isNaN(i)||(e=i):e=t,e},e.prototype.setAdVolume=function(e){this._adVolume=e,"number"==typeof this._videoEl.volume&&(this._videoEl.volume=e),S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVolumeChange})},e.prototype.getAdRemainingTime=function(){return this._adDuration-this._videoEl.currentTime},e.prototype.getAdDuration=function(){return this._adDuration},e.prototype.getAdIcons=function(){return this._adIcons},e.prototype.getAdSkippableState=function(){return this._adSkippableState},e.prototype.setVideoElSrc=function(e){e&&"string"==typeof e.fileURL&&e.fileURL.length?this._videoEl.src=e.fileURL:S.Util.fireError("Invalid mediaFile or mediaFile fileUrl",!0)},e.prototype.pickMediaFile=function(e){for(var n=this._adWidth*this._adHeight,t=function(e){var t={};t.bitrateRange=e.bitrate<5e3?0:1,t.canPlayType="probably"===this._videoEl.canPlayType(e.mimeType)?0:1;var i=e.width*e.height;return t.sizeDiff=m.abs(n-i),t.bitrate=e.bitrate,t.mediaFile=e,t}.bind(this),i=[],r=0;r<e.length;r++){var a=e[r];if(""!==this._videoEl.canPlayType(a.mimeType)){var o=t(a);i.push(o)}}return 0===i.length&&S.Util.fireError("There are no valid mediaFiles in underlying VAST tag",!0),i.sort(function(e,t){var i=e.bitrateRange-t.bitrateRange;if(0!=i)return i;var n=e.canPlayType-t.canPlayType;if(0!=n)return n;var r=e.sizeDiff-t.sizeDiff;return 0!=r?r:t.bitrate-e.bitrate}),i[0].mediaFile},e.prototype.onAdClick=function(){var e=(new u).getTime();if(!(void 0===this._lastClickTime)){if(e-this._lastClickTime<100)return}this._lastClickTime=e,void 0!==this._adIsStarted?this._videoEl.paused?this.resumeAd():(S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdClickThru,args:[this._clickthroughURL,null,!0]}),this._pauseAdOnClickThru&&this.pauseAd()):this.startAd()},e.prototype.videoErrorHandlerFn=function(e){var t=function(e){var t=a(e);if("unknown error triggered by player"===t)return!1;var i=["request is not allowed by the user agent or the platform in the current context","can only be initiated by a user gesture"];for(var n in i){var r=i[n];if(S.Util.arrayContains(t,r))return!0}return!1}(e)?"Autoplay attempted and is not allowed":a(e);S.Util.fireError(t,!0)},e.prototype.createListeners=function(){S.Util.addListener(S.ad._slot,"click",this.onAdClickHandler,"slotClickHandlerFn"),S.Util.addListener(S.ad._videoSlot,"click",this.onAdClickHandler,"videoSlotClickHandlerFn"),S.Util.addListener(this._videoEl,"error",this.onErrorHandler,"videoErrorHandlerFn")},e.prototype.determineQuartiles=function(){var e=this._adDuration/4;this._firstQuartileTime=0+e,this._midpointTime=this._firstQuartileTime+e,this._thirdQuartileTime=this._midpointTime+e},e.prototype.onConfirmDuration=function(e){if(!this._adDuration&&0!==this._adDuration){if(!S.ad._domElToTrack)return S.Util.fireError("no video element to track",!0),!1;S.Queue.publish("moat-tag",{videoElement:S.ad._domElToTrack,duration:e})}this._adDuration=e,this.determineQuartiles(),this._durationConfirmed=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdDurationChange,args:[e]})},e.prototype.confirmDuration=function(){if(!this._durationConfirmed){var e=this._videoEl&&this._videoEl.duration;"number"==typeof e&&!isNaN(e)&&0<e&&this.onConfirmDuration(m.round(e))}},e.prototype.timer=function(){var e,t=(e=this,function(){e.confirmDuration(),e._adDuration&&e.progressWatcher()});S.Util.setSafeLoop(t,[],500)},e.prototype.progressWatcher=function(){if(this._skipButtonManager&&!this._adSkippableState&&this._videoEl.currentTime>this._skipoffset&&(this._adSkippableState=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdSkippableStateChange})),S.Queue.publish("skip-button",{timeLeft:m.max(m.round(this._skipoffset-this._videoEl.currentTime),0)}),this._adIsStarted&&!this._firstQuartileReached&&this._videoEl.currentTime>this._firstQuartileTime)this._firstQuartileReached=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoFirstQuartile});else if(this._adIsStarted&&this._firstQuartileReached&&!this._midpointReached&&this._videoEl.currentTime>this._midpointTime)this._midpointReached=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoMidpoint});else if(this._adIsStarted&&this._firstQuartileReached&&this._midpointReached&&!this._thirdQuartileReached&&this._videoEl.currentTime>this._thirdQuartileTime)this._thirdQuartileReached=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoThirdQuartile});else if(this._adIsStarted&&this._firstQuartileReached&&this._midpointReached&&this._thirdQuartileReached&&!this._videoIsCompleted&&(this._videoEl.currentTime>=this._adDuration||this._videoEl.ended)){this.cleanUp(),this._videoIsCompleted=!0,S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdVideoComplete});S.Util.setSafeTimeout(function(){S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdStopped})},400)}this._adIsStarted&&!this._videoIsCompleted&&S.Queue.publish("vpaid-events",{type:S.VPAIDevents.AdProgress,time:this._videoEl.currentTime})},e.prototype.cleanUp=function(){this._cleanupCalled||(this._cleanupCalled=!0,S.Util.removeListener(this._videoEl,"playing",function(){},"videoPlayingHandlerFn"),S.Util.removeListener(S.ad._slot,"click",this.onAdClickHandler,"slotClickHandlerFn"),S.Util.removeListener(S.ad._videoSlot,"click",this.onAdClickHandler,"videoSlotClickHandlerFn"),S.Util.removeListener(this._videoEl,"error",this.onErrorHandler,"videoErrorHandlerFn"),S.Util.removeListener(this._videoEl,"canplay",this.publishAdLoaded,"publishAdLoadedFn"),S.ad._slot.style&&(S.ad._slot.style.cursor=this._originalSlotCursorStyle),S.ad._videoSlot.style&&(S.ad._videoSlot.style.cursor=this._originalVideoSlotCursorStyle),this._skipButtonManager&&this._skipButtonManager.cleanUp(),this._adIcons=!1)},e},w=function(){return(w=function(){this._iframe,this._adCompanions,this._lastAdVolume,this._adParameters,this._icons,this._iconManager,this._clickthroughURL}).prototype.init=function(e,t,i,n,r,a){var o=m.random()+"";if(window["moatstartvpaid"+o]=this.startVPAID.bind(this),window["moatstartvpaiderr"+o]=this.handleError.bind(this),e&&e.fileURL&&e.fileURL.match(/^https?:\/\/(s0\.2mdn\.net|imasdk\.googleapis\.com)/)){var s=document.createElement("script");s.type="text/javascript",s.onload=function(){window["moatstartvpaid"+o]()},s.onerror=function(){window["moatstartvpaiderr"+o]()},s.src=e.fileURL,S.Util.addTagSafely(s,document.body)}else{var d=document.createElement("iframe");(this._iframe=d).style.display="none",document.body.appendChild(d);var l='<html><head><body><script>function startVPAID() {window.parent["moatstartvpaid'+o+'"]();};function errVPAID() {window.parent["moatstartvpaiderr'+o+'"]();};<\/script><script onerror="errVPAID();" onload="startVPAID();" src="'+e.fileURL+'"><\/script></body></head></html>';d.contentWindow.moatsrc=l,d.src="javascript:window.moatsrc"}this._adCompanions=n,this._adParameters=t,this._icons=r,this._clickthroughURL=a,S.Queue.publish("moat-tag",{videoElement:S.ad._domElToTrack,duration:i})},w.prototype.handleError=function(){S.Util.fireError("no VPAID response",!0)},w.prototype.wrapGetAdCompanions=function(){var e=this,t=this._vpaid.getAdCompanions;this._vpaid.getAdCompanions=function(){return 0<e._adCompanions.length?S.Util.createXMLcompanionNode(e._adCompanions):t?t.call(e._vpaid):""}},w.prototype.createCallbacks=function(){var e={},t=this;for(var i in S.VPAIDevents){var n=function(){var e=i;return function(){"AdClickThru"===e&&arguments&&!arguments[0]&&(arguments[0]=t._clickthroughURL),S.Queue.publish("vpaid-events",{type:e,args:arguments})}}();e[i]=n}return e},w.prototype.startVPAID=function(){var r,a=this,o=!1,s=0;r=a._iframe?a._iframe.contentWindow:window;S.Util.setSafeLoop(function(){if(20<++s||o)return a.handleError(),!1;var e=r.getVPAIDAd&&"function"==typeof r.getVPAIDAd&&r.getVPAIDAd();if(e){a._vpaid=e,o=!0;e.handshakeVersion(S.version);var t=a.createCallbacks();for(var i in t)e.subscribe(t[i],i);a.wrapGetAdCompanions(),S.underlyingAsset=e;var n={AdParameters:a._adParameters};return e.initAd(S.ad._width,S.ad._height,S.ad._viewMode,S.ad._desiredBitrate,n,S.ad._environmentVars),e.getAdIcons&&e.getAdIcons()||!a._icons||!a._icons.length||(this._iconManager=new d(a._icons,S.ad._domElToTrack),S.HCP.adIconAvailable=!0),function(e){var t;try{t=e.getAdVolume()}catch(e){t=-1}S.Queue.publish("internal-events",{volume:t})}(e),!1}},[],100)},w}}(Date,Math)}catch(e){try{var t=e.name+" in VPAID wrapper global t/c: "+e.message+", stack="+e.stack,i="//px.moatads.com/pixel.gif?e=24&d=data%3Adata%3Adata%3Adata&i="+encodeURIComponent("TRADEDESKVIDEO1")+"&rp=1&gw=thetradedeskvideo910663478306&k="+encodeURIComponent(t)+"&ar="+encodeURIComponent("c26ce66e-clean")+"&iw="+encodeURIComponent("0625568")+"&j="+encodeURIComponent(document.referrer)+"&cs="+(new Date).getTime();(new Image).src=i}catch(e){}}}();
